{"title":"Plotly Tips","markdown":{"yaml":{"title":"Plotly Tips"},"headingText":"Plot types we've used","containsRefs":false,"markdown":"\n\nHere's a demo of various Plotly features and hacks.\n\n```python\nshow_plot( # <8>\n  px.scatter(votes, x='year', y='percent_yes', color='country',\n    facet_col='issue', facet_col_wrap=3, facet_col_spacing=.1, # <1>\n    trendline='lowess', # <2>\n    labels={\"percent_yes\": \"% Yes Votes\", \"year\": \"Year\", \"country\": \"Country\"}, # <3>\n    title=\"Percentage of 'Yes' votes in the UN General Assembly\" # <4>\n  )\n  .update_traces(marker_size=2) # <5>\n  .for_each_annotation(lambda a: a.update(text=a.text.split(\"=\", 1)[-1])) # <6>\n  .update_yaxes(tickformat=\",.0%\")) # <7>\n```\n1. **Faceting**: facet by `col`umns. `wrap` at 3 columns. `spacing` between columns.\n2. **Trendline**: add a `lowess` trendline. (Other options: `ols` for a linear regression)\n3. **Labels**: use human-readable labels for the axes and legend.\n4. Plot **title**.\n5. `update_traces` sets attributes on everything that gets drawn. `marker_size=2` is shorthand for `marker={'size': 2}`. See [Styling Markers](https://plotly.com/python/marker-style/) \n6. Remove the `=` from the annotation text. See [Annotations](https://plotly.com/python/text-and-annotations/)\n7. **Tick format**: use a percentage format for the y-axis. See [Tick Formatting](https://plotly.com/python/tick-formatting/)\n8. Hack for making plots show in RStudio. This also, incidentally, gives us an open paren, which is helpful because Python doesn't try to think that the code is done until we close that paren at the end. See [the Quarto page in these notes](quarto.qmd) for details on this hack.\n\n\n- `px.scatter`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.scatter.html)\n- `px.histogram`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.histogram.html)\n- `px.bar`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.bar.html)\n- `px.box`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.box.html)\n- `px.violin`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.violin.html)\n\n## Ticks\n\nTicks are the little marks on the axes that show where the values are. You can customize them using `update_xaxes` and `update_yaxes`. Useful attributes:\n\n- `nticks`: set the number of ticks. Example: `nticks=4`\n- `tickformat`: format the tick labels. Examples:\n  - `tickformat=\",.2f\"`: commas, 2 decimal places\n  - `tickformat=\",.0%\"`: percentage format with no decimal places\n  - `tickformat=\",.1%\"`: percentage format with 1 decimal place\n  - `tickformat=\"$,.0f\"`: dollar format with no decimal places\n- `tickvals`: put ticks at specific values. Example: `tickvals=[0, 1, 2, 3]` or `tickvals=gapminder['year'].unique()`\n- `ticktext`: use specific text for the tick labels. Example: `ticktext=[\"zero\", \"one\", \"two\", \"three\"]`\n\nMore [documentation](https://plotly.com/python/tick-formatting/) and the [full list of attributes](https://plotly.com/python/reference/layout/xaxis/).\n\n## Violins and Ridgeline Plots\n\nRidgeline plots are useful for visualizing how distributions change. You can make them in Plotly by tweaking a violin plot.\n\n```python\n(\n  px.violin(data, x=..., y=...)\n  .update_traces(side = 'positive', width=5, points=False)\n  .update_yaxes(showgrid=True)\n)\n```\n\nSee [docs](https://plotly.com/python/violin/#ridgeline-plot)\n\n## Category ordering\n\nPlotly's default is to put categories in the order they first appear in the data. Sometimes this is exactly what you want; you can just sort the data in exactly the order you want the categories to appear (using `sort_values`, for example).\n\nBut sometimes you want to override this. Plotly provides two ways to control the order of categories on an axis: the `category_orders` argument to some `px.*` functions, and the `categoryorder` attribute of the axis.\n\nIf you know the order you want to use (or you're mapping the categorical to `color` or something that doesn't have a corresponding axis), you can use `category_orders`.\n\nIf you just want to sort alphabetically or by total, you can use the [`categoryorder`](https://plotly.com/python/reference/layout/xaxis/#layout-xaxis-categoryorder) attribute.\n\nUseful ones:\n\n- `\"category ascending\"`: sort alphabetically\n- `\"category descending\"`: sort reverse alphabetically\n- `\"total ascending\"`: sort by value\n- `\"total descending\"`: sort by value, descending\n\nFor more complex sorting, you can use a list of category names. You set `categoryorder` to `\"array\"` and then set `categoryarray` to a list of category names in the order you want them to appear.\n\n## Typical imports\n\n```python\nimport numpy as np\nimport pandas as pd\nimport plotly.express as px\n```\n\n## Templates\n\nThe default Plotly template puts a gray background behind the plot. You can change the [template](https://plotly.com/python/templates/) by setting `pio.templates.default`:\n\n```python\nimport plotly.io as pio\nimport plotly.express as px\n\npio.templates.default = \"plotly_white\"\n```\n\n(You can also set a template on any individual `px.*` function by passing `template=\"plotly_white\"` as an argument.)\n\n\n## Examples of working around limitations of Plotly Express\n\nSometimes you need to make a plot that's not quite supported by Plotly Express. Here are some examples of how to do that.\n\n### Multiple traces on the same plot\n\nWhen the layouts are compatible (i.e., same axes and such), you can just add the traces together.\n\n```{python}\nimport plotly.express as px\n\ngapminder = px.data.gapminder()\ngapminder['neg_pop'] = -gapminder['pop']\n\nfig1 = px.area(\n  gapminder.query(\"country == 'United States' or country == 'Canada'\"),\n  x='year',\n  y='pop',\n  color=\"country\",\n  color_discrete_sequence=['#636EFA', '#EF553B'])\n\nfig2 = px.area(\n  (\n    gapminder\n    .query(\"country == 'China' or country == 'India'\")\n  ),\n  x='year',\n  y='neg_pop', color=\"country\",\n  color_discrete_sequence=['#00CC96', '#AB63FA'])\nfig1.add_traces(fig2.data)\nfig1\n```\n\n\n### Stacking Groups\n\nBars and areas can stack in \"groups\". Plotly Express doesn't seem to give an interface for this, but you can go in and change the traces after the fact.\n\n\n```{python}\ngapminder_4_countries = gapminder.query(\"country == 'United States' or country == 'Canada' or country == 'China' or country == 'India'\")\nfig = px.area(\n  gapminder_4_countries,\n  x='year',\n  y='pop',\n  color='country',\n)\nfor trace in fig.data:\n  if trace.name in ['China', 'India']:\n    trace.stackgroup = 2\n    trace.y = -trace.y\n  print(trace.name, trace.stackgroup)\nfig\n```","srcMarkdownNoYaml":"\n\nHere's a demo of various Plotly features and hacks.\n\n```python\nshow_plot( # <8>\n  px.scatter(votes, x='year', y='percent_yes', color='country',\n    facet_col='issue', facet_col_wrap=3, facet_col_spacing=.1, # <1>\n    trendline='lowess', # <2>\n    labels={\"percent_yes\": \"% Yes Votes\", \"year\": \"Year\", \"country\": \"Country\"}, # <3>\n    title=\"Percentage of 'Yes' votes in the UN General Assembly\" # <4>\n  )\n  .update_traces(marker_size=2) # <5>\n  .for_each_annotation(lambda a: a.update(text=a.text.split(\"=\", 1)[-1])) # <6>\n  .update_yaxes(tickformat=\",.0%\")) # <7>\n```\n1. **Faceting**: facet by `col`umns. `wrap` at 3 columns. `spacing` between columns.\n2. **Trendline**: add a `lowess` trendline. (Other options: `ols` for a linear regression)\n3. **Labels**: use human-readable labels for the axes and legend.\n4. Plot **title**.\n5. `update_traces` sets attributes on everything that gets drawn. `marker_size=2` is shorthand for `marker={'size': 2}`. See [Styling Markers](https://plotly.com/python/marker-style/) \n6. Remove the `=` from the annotation text. See [Annotations](https://plotly.com/python/text-and-annotations/)\n7. **Tick format**: use a percentage format for the y-axis. See [Tick Formatting](https://plotly.com/python/tick-formatting/)\n8. Hack for making plots show in RStudio. This also, incidentally, gives us an open paren, which is helpful because Python doesn't try to think that the code is done until we close that paren at the end. See [the Quarto page in these notes](quarto.qmd) for details on this hack.\n\n## Plot types we've used\n\n- `px.scatter`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.scatter.html)\n- `px.histogram`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.histogram.html)\n- `px.bar`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.bar.html)\n- `px.box`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.box.html)\n- `px.violin`: [API reference](https://plotly.com/python-api-reference/generated/plotly.express.violin.html)\n\n## Ticks\n\nTicks are the little marks on the axes that show where the values are. You can customize them using `update_xaxes` and `update_yaxes`. Useful attributes:\n\n- `nticks`: set the number of ticks. Example: `nticks=4`\n- `tickformat`: format the tick labels. Examples:\n  - `tickformat=\",.2f\"`: commas, 2 decimal places\n  - `tickformat=\",.0%\"`: percentage format with no decimal places\n  - `tickformat=\",.1%\"`: percentage format with 1 decimal place\n  - `tickformat=\"$,.0f\"`: dollar format with no decimal places\n- `tickvals`: put ticks at specific values. Example: `tickvals=[0, 1, 2, 3]` or `tickvals=gapminder['year'].unique()`\n- `ticktext`: use specific text for the tick labels. Example: `ticktext=[\"zero\", \"one\", \"two\", \"three\"]`\n\nMore [documentation](https://plotly.com/python/tick-formatting/) and the [full list of attributes](https://plotly.com/python/reference/layout/xaxis/).\n\n## Violins and Ridgeline Plots\n\nRidgeline plots are useful for visualizing how distributions change. You can make them in Plotly by tweaking a violin plot.\n\n```python\n(\n  px.violin(data, x=..., y=...)\n  .update_traces(side = 'positive', width=5, points=False)\n  .update_yaxes(showgrid=True)\n)\n```\n\nSee [docs](https://plotly.com/python/violin/#ridgeline-plot)\n\n## Category ordering\n\nPlotly's default is to put categories in the order they first appear in the data. Sometimes this is exactly what you want; you can just sort the data in exactly the order you want the categories to appear (using `sort_values`, for example).\n\nBut sometimes you want to override this. Plotly provides two ways to control the order of categories on an axis: the `category_orders` argument to some `px.*` functions, and the `categoryorder` attribute of the axis.\n\nIf you know the order you want to use (or you're mapping the categorical to `color` or something that doesn't have a corresponding axis), you can use `category_orders`.\n\nIf you just want to sort alphabetically or by total, you can use the [`categoryorder`](https://plotly.com/python/reference/layout/xaxis/#layout-xaxis-categoryorder) attribute.\n\nUseful ones:\n\n- `\"category ascending\"`: sort alphabetically\n- `\"category descending\"`: sort reverse alphabetically\n- `\"total ascending\"`: sort by value\n- `\"total descending\"`: sort by value, descending\n\nFor more complex sorting, you can use a list of category names. You set `categoryorder` to `\"array\"` and then set `categoryarray` to a list of category names in the order you want them to appear.\n\n## Typical imports\n\n```python\nimport numpy as np\nimport pandas as pd\nimport plotly.express as px\n```\n\n## Templates\n\nThe default Plotly template puts a gray background behind the plot. You can change the [template](https://plotly.com/python/templates/) by setting `pio.templates.default`:\n\n```python\nimport plotly.io as pio\nimport plotly.express as px\n\npio.templates.default = \"plotly_white\"\n```\n\n(You can also set a template on any individual `px.*` function by passing `template=\"plotly_white\"` as an argument.)\n\n\n## Examples of working around limitations of Plotly Express\n\nSometimes you need to make a plot that's not quite supported by Plotly Express. Here are some examples of how to do that.\n\n### Multiple traces on the same plot\n\nWhen the layouts are compatible (i.e., same axes and such), you can just add the traces together.\n\n```{python}\nimport plotly.express as px\n\ngapminder = px.data.gapminder()\ngapminder['neg_pop'] = -gapminder['pop']\n\nfig1 = px.area(\n  gapminder.query(\"country == 'United States' or country == 'Canada'\"),\n  x='year',\n  y='pop',\n  color=\"country\",\n  color_discrete_sequence=['#636EFA', '#EF553B'])\n\nfig2 = px.area(\n  (\n    gapminder\n    .query(\"country == 'China' or country == 'India'\")\n  ),\n  x='year',\n  y='neg_pop', color=\"country\",\n  color_discrete_sequence=['#00CC96', '#AB63FA'])\nfig1.add_traces(fig2.data)\nfig1\n```\n\n\n### Stacking Groups\n\nBars and areas can stack in \"groups\". Plotly Express doesn't seem to give an interface for this, but you can go in and change the traces after the fact.\n\n\n```{python}\ngapminder_4_countries = gapminder.query(\"country == 'United States' or country == 'Canada' or country == 'China' or country == 'India'\")\nfig = px.area(\n  gapminder_4_countries,\n  x='year',\n  y='pop',\n  color='country',\n)\nfor trace in fig.data:\n  if trace.name in ['China', 'India']:\n    trace.stackgroup = 2\n    trace.y = -trace.y\n  print(trace.name, trace.stackgroup)\nfig\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"toc-depth":4,"output-file":"plotly.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","theme":"yeti","toc_float":true,"toc-expand":4,"title":"Plotly Tips"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}