---
title: "HW 2: More Visualization Practice"
output: 
  tufte::tufte_html:
    css: ../hw.css
    tufte_variant: "envisioned"
    highlight: pygments
link-citations: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
options(dplyr.summarise.inform = FALSE)
```

We will be continuing our work with the [Capital Bikeshare dataset](https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset) that we started in Homework 1. Our goal continues to be to understand ridership patterns to evaluate the current system and suggest potential improvements.

Towards that end, we will construct some more visualizations, this time using more fine-grained ridership data.

## Learning goals

Getting proficient at designing and implementing data visualizations takes practice. The goal of this assignment is to give you practice:

-   Interpreting the structure of a dataset
-   Choosing the the structure of a visualization according to characteristics of the data and questions to be answered.
-   Constructing a visualization using the `ggplot` toolkit
-   Interpreting a visualization

You will also gain practice at:

-   Analyzing a visualization in terms of the Grammar of Graphics
-   Making data-driven arguments

Upon completing this homework, you will have greater comfort making and refining visualizations using the Grammar of Graphics. You will also gain some initial exposure to data wrangling, which we will study in depth next week.

## Tips for Success

-   Work at this a little bit at a time.
-   Refer to what you did in Guided Exercise 3; much of this is very similar to that.
-   If you're stuck on some coding aspect, ask for help soon: don't spend more than 15 minutes trying to figure out a coding problem.
-   As always, if you need help, post in Piazza or come to office hours!

See also the "Data Visualization with ggplot2" cheatsheet available under the RStudio Help menu and other resources linked on the Materials section of the course Syllabus.

## Getting started

Pull your Portfolio repo and find `hw/hw02/hw02-vis.Rmd`.

Update the title and author, Knit, Commit, Push.

### Exercise 0: Getting to know the data

The report starts with a code block that reads the data and sets the correct data types for several of the columns. You do not need to understand how this code works at the moment.

```{r read-data, message=FALSE, include=FALSE}
roundtrip_csv <- function(data, filename) {
  write_csv(data, filename)
  read_csv(filename)
}

daily_rides <- read_csv(here::here("docs/data/bikeshare/day.csv")) %>%
  mutate(workingday = case_when(workingday == 1 ~ "workday",
                                          TRUE ~ "weekend"),
         ) %>%
  select(
    date = dteday,
    season,
    year = yr,
    holiday,
    workingday = workingday,
    day_of_week = weekday,
    weather_type = weathersit,
    temp,
    feels_like = atemp,
    humidity = hum,
    wind_speed = windspeed,
    casual,
    registered
  ) %>%
  mutate(
    year = year + 2011,
    holiday = if_else(holiday == 1, "Y", "N"),
    season = c("W", "S", "U", "F")[season],
    temp = temp * (39 + 8) - 8,
    feels_like = feels_like * (50 + 16) - 16,
    wind_speed = wind_speed * 67
    ) %>% 
  pivot_longer(c(casual, registered),
               names_to = "rider_type",
               values_to = "rides") %>% 
  relocate(date, rider_type, rides) %>% 
  mutate(across(c(season, year, holiday, workingday, day_of_week, weather_type, rider_type), as.factor))

daily_rides <- roundtrip_csv(daily_rides, here::here("src/hw/hw02-vis/data/day.csv"))

if(FALSE) {
hourly_rides <- read_csv("../../data/bikeshare/hour.csv") %>%
  mutate(workingday = case_when(workingday == 1 ~ "workday",
                                          TRUE ~ "weekend"),
         ) %>%
  select(
    date = dteday,
    hour = hr,
    season,
    year = yr,
    holiday,
    workingday = workingday,
    day_of_week = weekday,
    weather_type = weathersit,
    temp,
    feels_like = atemp,
    humidity = hum,
    wind_speed = windspeed,
    casual,
    registered
  ) %>%
  mutate(season = c("W", "S", "U", "F")[season]) %>% 
  pivot_longer(c(casual, registered),
               names_to = "rider_type",
               values_to = "rides") %>% 
  relocate(date, hour, rider_type, rides) %>% 
  mutate(across(c(season, year, hour, holiday, workingday, day_of_week, weather_type, rider_type), as.factor))

hourly_rides %>% write_csv(here::here("src/hw/hw02-vis/data/hour.csv"))
hourly_rides <- read_csv(here::here("src/hw/hw02-vis/data/hour.csv"))
}
```

Notice also that the template shows two different ways shown of getting a quick look at the data. You are not expected to understand the code for them, but try to understand what the output means.

### What are the columns?

Observe that there are some extra columns now.

The **id columns** are the columns that uniquely identify an observation (sometimes called a "case" instead of "observation"). [^1] In Homework 1, we only had one id column, `date`, because we had one observation for each date. (Consider why `day_of_week` and `workingday` would not be considered *id* columns.)

[^1]: The id columns are analogous to *independent variables*, except that that terminology often implies that we're running an experiment, which is not necessarily the case.

The dataset for this homework has *two* id columns:

-   `date`: as before
-   `rider_type`: `registered` or `casual` (see below)

The additional id column means that we've now broken down the data by rider type (`rider_type`). Some riders have `registered` for a Capital Bikeshare membership to get better rates. Other riders just bought a single trip or short-term pass, so we call them `casual` riders.

```{marginfigure}
According to the [source data](https://www.capitalbikeshare.com/system-data), "casual" riders include: Single Trip, 24-Hour Pass, 3-Day Pass or 5-Day Pass
```

So: each row is the count of how many *rides* were completed on a given day by a given type of rider. For each row, we have the following observed variables:[^2]

[^2]: These are analogous to *dependent variables*, but again that may imply too much.

-   `rides`: the number of rides by that type of rider
-   `season`: Winter, Spring, sUmmer, or Fall
-   `year`: 2011 or 2012.
-   `holiday`: `N` for ordinary days, `Y` for holidays
-   `workingday`: either "weekday" or "weekend" (where "weekend" includes holidays too).
-   `day_of_week`: an integer between 0 and 6 inclusive. In this exercise, you will decode which number represents Monday, etc.
-   `temp`: the average temperature that day, in degrees C
-   `feels_like`: the "feels-like" temperature in degrees C
-   `humidity`: relative humidity, scaled to range from 0 to 1
-   `weather_type` and `windspeed`: see the [source data](https://archive.ics.uci.edu/ml/datasets/bike+sharing+dataset) for a description

## Exercise 1: Label days of week

The data set uses the integers 0 through 6 to label days of the week. It does not document, however, what 0 means, or what 6 means. If we want to make understandable plots, we should label these days of the week.

First, *look at the data* to figure out what a `day_of_week` of 0 means. Then what a `day_of_week` of 1 means. You may find it helpful to refer to a calendar.

Once you've figured it out:

1.  Write a brief description of what the mapping is and your evidence that you got it correct.
2.  Fill in the blank in the given code block to give labels to the weekdays. Use abbreviations ("Wed", "Fri", ...).
3.  Check your `daily_rides` dataframe to make sure the result is correct.

```{r label-weekdays, include=FALSE}
daily_rides <- daily_rides %>%
  mutate(day_of_week = factor(day_of_week, levels = c(0, 1, 2, 3, 4, 5, 6), labels = c("Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat")))
```

## Exercise 2: Describe a row

Write a succinct English sentence that conveys the same information as the first row in the data frame. *Only consider the `date`, `rider_type`, `rides`, `holiday`, `workingday`, and `day_of_week` columns.*

## Exercise 3: Rides by date, by rider type

Make a scatterplot of the number of rides by date, broken down by type of rider. Tips:

-   Refer to your Homework 1 solution for a very similar (but not identical) plot.
-   Make the points smaller (`size` of 1) and partially transparent (`alpha` of 0.5) to reduce *overplotting*.
-   Your plot should be fully labeled.

Here is one possibility:

```{r rides-by-date-membership, echo=FALSE, fig.fullwidth = TRUE}
ggplot(daily_rides, aes(x = date, y = rides, color = rider_type)) +
  geom_point(alpha = 0.5, size = 1) +
  geom_smooth(method = "loess", formula = y ~ x) +
  labs(x = "Date", y = "Number of rides", color = "Type of Rider", title = "Rides by date", subtitle = "for casual and registered riders")
```

Write a brief interpretation of this plot.

## Exercise 4: Mapping vs Faceting

Now let's look at workdays vs weekends (and holidays). This is encoded in the `workingday` variable, like in Homework 1.

First, make a scatterplot like in Exercise 3, but map `shape` to `workingday`.

```{r rides-by-date-membership-workingday, include=FALSE}
ggplot(daily_rides, aes(x = date, y = rides, color = rider_type, shape = workingday)) +
  geom_point(alpha = 0.5, size = 1) +
  geom_smooth() +
  labs(x = "Date", y = "Number of rides", color = "Type of Rider", title = "Rides by date", shape = "Type of Day")
```

Next, try *faceting* by `workingday` instead.

```{r include=FALSE}
ggplot(daily_rides, aes(x = date, y = rides, color = rider_type)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(workingday), nrow = 2)
```

Next, try swapping the roles of `rider_type` and `workingday` in the faceted scatterplot.

```{r include=FALSE}
ggplot(daily_rides, aes(x = date, y = rides, color = workingday)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(rider_type), nrow = 2)
```

Try adjusting parameters for the faceting: should you use rows vs columns? Should you use free or fixed y scales?

Once you're done, **pick two plots** to leave in this section and remove all the others. (1) Describe the structure the first plot, (2) describe the structure of the second plot, and (3) **Compare and contrast** the two plots: for which purpose is each one better? What about the design of the plot makes it fit that purpose?


## Exercise 5: How does ridership vary over a typical week?

We want to find out how ridership varies over a typical week. Before moving on, think to yourself:

- This question is asking about the relationship between *which variables*?
- *Sketch a visualization* (on scrap paper) that might answer this question.

<br><br><br>

This question is asking about how *rides* relates with *day of week*. We should show not just a single number for each day but rather the *distribution* of rides each day of the week. And we should break it down by rider type.

Here's one possible plot; try to make it.

```{r ride-distributions-by-weekday, echo=FALSE, fig.fullwidth=TRUE}
daily_rides %>%
  ggplot(aes(x = day_of_week, y = rides, fill = rider_type)) +
  geom_boxplot() +
  labs(y = "Rides", x = "Day of Week", fill = "Type of Rider")
```

Once you have that plot, try a few variations: faceting, using different plot types, etc.)

Write a one-sentence description of what the plot tells you about the data.

## Exercise 6: Plot of your choice

Pick another variable or two from the list of variables above. Make a plot of their relationship. 

Write a one-sentence description of what the plot tells you about the data.
