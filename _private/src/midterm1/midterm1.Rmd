---
title: "21FA DATA 202 Midterm 1"
output:
  pdf_document:
    includes:
      in_header: header.tex
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = "")
library(tidyverse)
library(patchwork)
library(nycflights13)
theme_set(theme_bw())
```

# 21FA DATA 202 Midterm 1

<!-- Next year: -->
<!-- - Clarify that question 5 (and similar) is not about writing code at all. -->
<!-- Leave more space! -->

<!-- ## Objectives -->

<!-- - Relate the structure of a dataset to the structure of a visualization of it -->
<!-- - Analyze a visualization in terms of the grammar of graphics. -->
<!-- - Predict the effects of fundamental data manipulation operations -->
<!-- - Compose a sequence of data manipulation steps to achieve a desired data manipulation operation -->

In a preparatory exercise you worked with data from the `nycflights13` package, which contains data about flights that departed from New York City (i.e., airports EWR, JFA, and LGA) in 2013. We will be working with the `flights` table, which has one row per flight. Here is a sample containing 10 rows of that table:

```{r echo=TRUE, results='hide', cache=TRUE}
set.seed(0)
flights_sample <- flights %>%
  slice_sample(n = 10) %>%
  select(year, month, day, hour, carrier, origin, dest, dep_delay, arr_delay)
flights_sample
```

```{r echo=FALSE}
flights_sample %>% pander::pander()
```

The `nycflights13` package also provides a table of `airlines`:

```{r}
airlines %>% pander::pander()
```


## Visualization Exercises

Consider the following two plots. Both are based on the full `flights` data frame, but the data may have been transformed in some way before the plot.


```{r plots-to-analyze, fig.asp=1}
mean_delays_by_hr <- nycflights13::flights %>% 
  filter(!is.na(dep_delay)) %>% 
  group_by(origin, hour) %>% 
  summarize(mean_dep_delay = mean(dep_delay, na.rm = TRUE), .groups = "drop")

plotA <- mean_delays_by_hr %>% 
  ggplot(aes(x = hour, y = mean_dep_delay, color = origin, shape = origin)) +
    geom_point(size = 3) +
  scale_color_viridis_d()

plotB <- mean_delays_by_hr %>% 
  ggplot(aes(x = origin, y = mean_dep_delay, fill = factor(hour))) +
    geom_col(position = "dodge") +
    scale_fill_viridis_d(guide = guide_legend(nrow = 2, byrow = TRUE)) +
    theme(legend.position = "bottom") +
    labs(fill = "hour")

plotA / plotB + plot_annotation(tag_levels = "A")
```


1. What type of plot is plot A?

\vspace{2em}

2. What type of plot is plot B?

\vspace{2em}

3. Make a table of the aesthetic mappings for plot A.

\vspace{4em}

4. Make a table of the aesthetic mappings for plot B.

\vspace{4em}


5. Suppose plot A was constructed by supplying `tableA` to a `ggplot` command, and that nothing fancy happens in the `ggplot` (no `geom`s that count rows, no `stat_*` commands, etc.).

    a. Give a plausible example of the first 3 rows of `tableA` (i.e., `head(tableA, 3)`). Omit any columns that aren't used in the plot.
    
    \vspace{4em}
    
    b. How many rows do you expect `tableA` to have? Write (but do not evaluate) the multiplication expression that you would enter into a simple calculator to give the this result.

    \vspace{2em}

6. Repeat problem 5 for plot B (`tableB`), with the same instructions (abbreviated below).

    a. Give a plausible example of the first 3 rows of `tableB`.
    
    \vspace{4em}
    
    b. How many rows do you expect `tableB` to have?

    \vspace{2em}
    

7. Give an example of something that you can notice about the data (i.e., a comparison you can make) *more easily in plot A than in plot B*.

    a. What is the specific observation you make? (e.g., "The mean delay for XXX is higher for ...")
  
    \vspace{2em}
    
    b. What about the design of the visualization makes that comparison easier in plot A?

    \vspace{4em}

8. Repeat problem 7, but for plot B instead.

    a. What is the specific observation you make? (e.g., "The mean delay for XXX is higher for ...")
  
    \vspace{2em}
    
    b. What about the design of the visualization makes that comparison easier in plot B?

    \vspace{4em}

9. Identify a change to make to plot A that would improve it.

    a. Circle or draw an arrow to the part of the plot that you would change.
    
    b. Next to the plot, sketch what that part of the plot would look like after your change.
    
10. Repeat problem 9 for plot B.

## Data Transformation Exercises

For each of the following pipelines:

- Specify the *shape*: the total number of rows and columns in the result.
- Give the first two rows of the result.

All of the pipelines use the table `flights_sample` shown on the first page. Note that it only has `r nrow(flights_sample)` rows, so you can perform all of these operations by hand. 

Each exercise is 2 points for  **correct** and **complete** column names, 1 point for correct number of rows, and 1 point for correct content.

#### Exercise 11

Shape: __ rows, __ cols

```{r echo=TRUE, results='hide'}
flights_sample %>% 
  arrange(dep_delay)
```

\vspace{4em}

#### Exercise 12

Shape:

```{r echo=TRUE, results='hide'}
flights_sample %>%
  filter(hour > 16 & arr_delay > 0)
```

\vspace{4em}


#### Exercise 13

Shape: 

```{r echo=TRUE, results='hide'}
flights_sample %>% 
  group_by(origin) %>% 
  summarize(count = n()) %>% 
  arrange(desc(count))
```

\vspace{4em}

#### Exercise 14

Shape:

```{r echo=TRUE, results='hide'}
flights_sample %>% 
  filter(origin == "LGA") %>% 
  left_join(airlines, by = "carrier")
```
\vspace{4em}

#### Exercise 15

Shape:

```{r results='hide', echo=TRUE, message=FALSE}
flights_sample %>% 
  pivot_longer(
    cols = c('origin', 'dest'),
    names_to = "role",
    values_to = "airport") %>% 
  group_by(role, airport) %>% 
  summarize(count = n())
```

\vspace{4em}
