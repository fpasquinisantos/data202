---
title: "Homework 3: Bike Sharing Data Wrangling"
author: "YOUR NAME"
date: "TODAY'S DATE"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)

# Disable a warning message.
options(dplyr.summarise.inform = FALSE)
```


## Load Data

```{r load-data}
# Read the file, specifying data types for each column.
rides_2011 <- read_csv("data/rides_2011.csv.gz", col_types = cols(
  start_time = col_datetime(),
  duration = col_double(),
  member_type = col_factor()
))
rides_2012 <- read_csv("data/rides_2012.csv.gz", col_types = cols(
  start_time = col_datetime(),
  duration = col_double(),
  member_type = col_factor()
))
```

## Exercise 1

```{r bind-rows}
rides <- bind_rows(
  rides_2011,
  rides_2012
)
```

There are `r nrow(rides)` rides in this dataset.

## Exercise 2

`duration` is probably measured in seconds.

```{r}
median_ride_duration <- median(rides$duration)
```

1. The median of `duration` is `r median_ride_duration`.
2. If duration were measured in seconds, the median ride duration would be `r median_ride_duration`  sec / (60 sec/min) = `r round(median_ride_duration / 60, 2)` minutes (i.e., half of all rides would be shorter than 11 minutes).
3. If duration were measured in the next smaller unit (milliseconds), the median ride length would be `r median_ride_duration / 1000` seconds.
4. If duration were measured in the next larger unit (minutes), half of all rides would be longer than `r median_ride_duration` min / (60 min / hr) = `r round(median_ride_duration / 60, 2)` hours.
5. Of these possibilities, 10 minutes is the most plausible, given my own experience riding bikes (1 sec isn't long enough to get anywhere, and 11 hours is a very long ride).
6. Since interpreting duration as being reported in seconds gave the most realistic median ride duration when compared with both the next smaller and larger common units, I infer that seconds is the most plausible unit.

Some rides are as short as `r min(rides$duration)` seconds (1 minute), and others are as long as 
`r format(max(rides$duration), scientific = FALSE, big.mark = ",")`, which is most of a day (86,400 seconds).

We can also visualize the order of magnitude of duration using a histogram of the 
base-10 log of the duration. We'll go ahead and divide by 60 so the scale is in minutes:

```{r duration-hist}
rides %>% 
  ggplot(aes(x = log10(duration / 60))) +
    geom_histogram(binwidth = .5)
```

or a boxplot drawn on a log scale:

```{r duration-boxplot}
ggplot(rides, aes(x = duration / 60)) +
  geom_boxplot() +
  scale_x_log10()
```

Let's also look at the quantiles (the edges of the box) directly:

```{r}
quantile(rides$duration / 60, c(.25, .75))
```


If we assume that duration is measured in seconds, both graphs show us that the
bulk of rides were between 6 and 20 minutes, which seems very reasonable.

## Exercise 3

```{r count-member-type}
rides %>%
  count(member_type)
```

## Exercise 4

```{r aggregate-hourly}
hourly_rides <- rides %>%
  group_by(start_hour = floor_date(start_time, unit = "hours")) %>% 
  count()
```

## Exercise 5

```{r count-by-hour-and-member-type}
hourly_rides <- rides %>%
  group_by(hour = floor_date(start_time, unit = "hours"), member_type) %>% 
  summarize(rides = n())
```

## Exercise 6

```{r count-by-day-and-member-type}
daily_rides <- rides %>%
  group_by(day = floor_date(start_time, unit = "days"), member_type) %>% 
  summarize(rides = n())
```

## Exercise 7

```{r rides-by-weekday}
hourly_rides %>%
  filter(member_type != "Unknown") %>% 
  ggplot(aes(x = wday(hour, label = TRUE), y = rides, fill = member_type)) +
  geom_boxplot() +
  labs(y = "Rides", x = "Day of Week", fill = "Type of Rider")
```

## Exercise 8

```{r rides-by-weekday-table, echo=FALSE}
hourly_rides %>% 
  filter(member_type != "Unknown") %>% 
  group_by(weekday = wday(hour, label = TRUE), member_type) %>% 
  summarize(median_rides = median(rides)) %>% 
  pivot_wider(names_from = member_type, values_from = median_rides) %>% 
  knitr::kable()
```


## Exercise 9

```{r ride-distributions-by-hour, fig.height=10, fig.width=10}
hourly_rides %>% 
  filter(member_type != "Unknown") %>% 
  mutate(is_weekend = if_else(
    wday(hour, label = TRUE) %in% c("Sat", "Sun"),
    "Weekend", "Weekday")) %>% 
  ggplot(aes(x = as_factor(lubridate::hour(hour)), y = rides, fill = member_type)) + 
    geom_boxplot() +
    facet_wrap(~ is_weekend, scales = "free_y", nrow = 2)
```
