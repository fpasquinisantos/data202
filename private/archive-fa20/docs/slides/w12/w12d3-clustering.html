<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Unsupervised Learning (clustering)</title>
    <meta charset="utf-8" />
    <meta name="author" content="K Arnold" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Unsupervised Learning (clustering)
### K Arnold

---




&lt;style&gt;
.two-column {
  columns: 2;
}
&lt;/style&gt;


## Q&amp;A

* Midterm average was 85%.

&gt; Can we use inference in projects?

* Many people asked "which variables are important for predicting?" -- Wednesday
  approach works for that.
* Others want to know specific relationships. See the plot strategy in Lab 10,
  and the `infer` package vignette from prep reading.

&gt; How much difference in MAE (or RMSE, specificity, etc.) is meaningful?

* Look at the confidence intervals.
* Depends on your problem!

---

## Project Logistics

* No final exam, just project.
* Next milestone: by Thanksgiving, have some initial EDA
* Proposal feedback is in-progress

---

## Other logistics

* No quiz, no homework this week; just work on projects
* Midterm project feedback is coming...

&gt; Which other packages do you use? (besides `tidyverse`)

* `glue`: for constructing strings `"{nrows(data)} rows"`
* [`patchwork`](https://patchwork.data-imaginist.com/index.html) for arranging plots
* `knitr` for `include_graphics` (or just `![](image-url)`)

---

## Unsupervised Learning

* So far we have been doing *supervised* learning, where have a *target* we're trying to predict.
  * "How much will these homes sell for?"
  * "How long will this person spend watching this video?"
* **Unsupervised** learning works when we don't have an exact target to predict, or we want to explore relationships in the data.
  * "What general types of homes are on the market right now?"
  * "What are some different segments of our customer base?"
  * "[Are there distinct types of Covid-19 symptoms?](https://covid.joinzoe.com/us-post/covid-clusters)"
* **Clustering** is one very common type of unsupervised learning.

---

## Clustering

Goal: put observations into groups

* Those in the *same* group should be *similar to each other*
* Those in *different* groups should be *different*.

Crucial questions:

* How many groups?
* How do we define "similar" / "different"?

---

![](img/kmeans_1.jpg)

.floating-source[Artwork by [@allison_horst](https://github.com/allisonhorst/stats-illustrations)]
---

![](img/kmeans_2.jpg)

---
![](img/kmeans_3.jpg)

---
![](img/kmeans_4.jpg)

---
![](img/kmeans_5.jpg)

---
![](img/kmeans_6.jpg)

---
![](img/kmeans_7.jpg)

---
![](img/kmeans_8.jpg)

---
![](img/kmeans_9.jpg)

---
![](img/kmeans_10.jpg)
---

![](img/kmeans_11.jpg)

---
![](img/kmeans_12.jpg)

---

## *Many* types of clustering algorithms

![](https://scikit-learn.org/stable/_images/sphx_glr_plot_cluster_comparison_0011.png)
.floating-source[Source: [sklearn documentation](https://scikit-learn.org/stable/modules/clustering.html)]

---






```r
set.seed(20201120)
clustering_results &lt;- 
  recipe( ~ Latitude + Longitude + Gr_Liv_Area, data = ames_all) %&gt;% 
  step_range(Gr_Liv_Area, min = 0, max = 1) %&gt;% 
  step_range(Latitude, min = 0, max = 1) %&gt;% 
  prep() %&gt;% 
  bake(new_data = ames_all) %&gt;% 
  kmeans(nstart = 4, centers = 3)

ames_with_clusters &lt;- ames_all %&gt;% 
  mutate(.cluster = as.factor(clustering_results$cluster))
```



```r
glance(clustering_results)
```

```
## # A tibble: 1 x 4
##   totss tot.withinss betweenss  iter
##   &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
## 1  180.         65.5      114.     4
```

```r
tidy(clustering_results)
```

```
## # A tibble: 3 x 6
##   Latitude Longitude Gr_Liv_Area  size withinss cluster
##      &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;fct&gt;  
## 1    0.579     -93.6       0.268  1161     23.8 1      
## 2    0.264     -93.6       0.362   449     18.2 2      
## 3    0.862     -93.6       0.395   802     23.5 3
```
---

.small-code[

```r
latlong_plot &lt;- 
  ggplot(ames_with_clusters, aes(x = Latitude, y = Longitude, color = .cluster)) +
    geom_point(alpha = .5)

year_area_plot &lt;- 
  ggplot(ames_with_clusters, aes(x = Gr_Liv_Area, y = Year_Built, color = .cluster)) +
    geom_point(alpha = .5)

latlong_plot + year_area_plot + plot_layout(guides='collect')
```

&lt;img src="w12d3-clustering_files/figure-html/cluster-plots-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Activities

.comfortable[.two-column[
1. What differences do you notice between the plot on the left and the plot on the right?
1. Try increasing the number of `centers`. What changes about both plots?
2. Try changing the formula to `~ Year_Built` (removing latitude and longitude). What can you say about the age of homes in different parts of town?
2. Try adding `Gr_Liv_Area` to the recipe's formula (`Latitude + Longitude + Gr_Liv_Area`). What changes about both plots?
  Why are they different?
2. Try adding `step_range(Gr_Liv_Area, min = 0, max = 1)` to the recipe construction pipeline. What changes about both plots? Why?
2. Try adding a `step_range` for `Latitude` (but not `Longitude`). What changes and why?
2. Now add a `step_range` for `Longitude`. What changes and why?
2. Try changing `max` to `10` for `Gr_Liv_Area`. Then try `max = 0.1`. What changes and why?
2. Try adding `Year_Built`.
]]

---

Do the patterns captured by these clusters also happen to relate to sale price?


```r
ames_with_clusters %&gt;% 
  ggplot(aes(x = Sale_Price, y = .cluster)) + geom_boxplot()
```

&lt;img src="w12d3-clustering_files/figure-html/sale-price-by-cluster-1.png" width="100%" style="display: block; margin: auto;" /&gt;

---

## Appendix

```r
library(tidymodels)
library(patchwork)
```

```r
#data(ames, package = "modeldata")
ames &lt;- AmesHousing::make_ames()
ames_all &lt;- ames %&gt;%
  filter(Gr_Liv_Area &lt; 4000, Sale_Condition == "Normal") %&gt;%
  mutate(across(where(is.integer), as.double)) %&gt;%
  mutate(Sale_Price = Sale_Price / 1000)
rm(ames)
```

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
