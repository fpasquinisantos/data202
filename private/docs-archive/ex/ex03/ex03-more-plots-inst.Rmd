---
title: "Guided Exercise 3: More Plotting!"
output: 
  tufte::tufte_html:
    css: ../ex.css
    tufte_variant: "envisioned"
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(scales)
library(gapminder)
gapminder <- gapminder::gapminder # Put the data in the Environment
gapminder_latest <- filter(gapminder, year == 2007)
show_examples <- FALSE
```

## Goals

* Practice making various kinds of plots using `ggplot`
* Practice interpreting different kinds of plots.

## Getting Started

Like last week, we're using our **portfolio repo** for this assignment. So:

- Open your `portfolio` project in RStudio (you should see `Project: portfolio-YOURGITHUB` in the top right).
- Go to the Git tab in RStudio and click `r emo::ji("arrow_down")` **Pull**.
- Find and open `ex03/ex03-more-plotting.Rmd` (you may need to navigate in the Files tab to find it).
- Change the `title` in the YAML header (surrounded by `---`s) to "Exercise 3: More Plotting" (*with* the quotes or you'll get a strange YAML error), change the author name to your name, and Knit it to make sure everything works.

`r emo::ji("white_check_mark")` `r emo::ji("arrow_up")` *Now is a good time to commit and push your changes to GitHub with an appropriate commit message. Make sure to commit and push all changed files so that your Git pane is cleared up afterwards.*

Now, Run All chucks. Look in the Environment tab. You'll see two data frames:

- `gapminder`: the data we used last time, from the `gapminder` package
- `gapminder_latest`: data from just 2007. This is useful for plots that don't involve year.

Look at each to see how they are structured.

## Working Together

Proceed section by section with your partner. In each section:

1. Try the exercise yourself for a minute or two.
2. Check in with your partner. Help each other get unstuck.
3. Write a short interpretation of the plot together.
4. Try some minor variation just to see what happens.

Some sections have additional questions.

### Getting Help

- Remember that you can `F1` a function to get help, or type `?geom_point` or similar on the *Console*.
- Some other references including cheat sheets are linked on the [syllabus](https://cs.calvin.edu/courses/data/202/21fa/#Materials)

## Styling and labeling plots

Each of these sections will correspond to sections in your `ex03-more-plotting.Rmd` template. Fill them in there.

Modify the following plot to:

1. Add labels (`labs`) for the `x` and `y` axes. Use `?gapminder` at the Console to get the data documentation if needed.
2. Add a `title` (also `labs`).
3. Set the `color` of the line to `green`. (Is it green now?)
4. Set the chunk name to something more meaningful than `plot-1`.

```{r plot-1}
gapminder %>% 
  filter(country == "United States") %>% 
  ggplot(aes(x = year, y = lifeExp)) +
    geom_line()
```

## Mapping vs Faceting

Consider this plot, which is also in your template:

```{r plot-2}
countries <- c(
  "China", "India", "United States",
  "Indonesia", "Brazil", "Pakistan",
  "Bangladesh", "Nigeria", "Japan")

gapminder %>% 
  filter(country %in% countries) %>% 
  ggplot(aes(x = year, y = lifeExp)) +
    geom_line()
```

Notice that we're `filter`ing to only include rows where the `country` is in the list of `countries` that we made.
This is so that we don't have `r length(unique(gapminder$country))` different colors or facets in these graphs.

<!-- This confused students in 21FA: they thought that they needed to copy it into all of the subsequent plots; others tried to use "countries" in the plots! Maybe give a pre-made filtered tibble. -->

1. Explain to your partner why the plot has the shape it does. (If you're not sure, click `gapminder` in  the Environment pane and think about how you'd draw a line with that data.)
2. Map `color` to `country`. Describe the plot you get.
3. In a new chunk, *facet* by country instead. (Should you use `facet_grid` or `facet_wrap`?)
4. Finally, try setting `scales = "free_y"` in the faceting function.

```{marginfigure}
The country list came from:

`gapminder %>%
  group_by(country) %>%
  slice_tail(n = 1) %>%
  arrange(desc(pop)) %>%
  head(9) %>%
  pull(country)`
```

Discuss the differences between the different plots you get.

- What is the faceted plot good for?
- What is the not-faceted plot good for?
- What changes would you want to make to these plots to make them more legible?


```{r include=show_examples}
gapminder %>% 
  filter(country %in% countries) %>% 
  ggplot(aes(x = year, y = lifeExp)) +
    geom_line() +
    facet_wrap(vars(country))
```

## Univariate analysis - Continuous

Pick one of the continuous variables. Make two different types of plots to show its distribution.

```{r include=show_examples}
ggplot(gapminder, aes(x = lifeExp)) + geom_density()
```

```{r include=show_examples}
ggplot(gapminder, aes(x = lifeExp)) + geom_boxplot()
```

## Univariate Analysis - Categorical

Make a bar plot of the number of countries by continent. (Use `gapminder_latest`, which has one row per country.)

```{r include=show_examples}
gapminder %>% 
  filter(year == 2007) %>% 
  ggplot(aes(x = continent)) + geom_bar()
```

Discuss the interpretation of this plot with your partner.

## Bivariate: Relationship between numerical and categorical

Pick one of the continuous variables and plot its relationship with `continent`.

Note:

- You may again want to filter for only a year of 2007.
- You may want to try using `log(variable)` instead of `variable`.

Make two different visualizations. Compare and contrast them.

```{r include=show_examples}
gapminder_latest %>% 
  ggplot(aes(x = lifeExp, y = continent)) +
  geom_boxplot()
```

```{r include=show_examples}
gapminder_latest %>% 
  ggplot(aes(x = lifeExp, y = continent)) +
  geom_violin()
```

```{r include=show_examples}
gapminder_latest %>% 
  ggplot(aes(x = lifeExp, color = continent)) +
  geom_density()
```

## Ridge Plots!

Try out the ridge plot in the example code. Try setting color and fill. Then try mapping them.

```{r}
library(ggridges)
gapminder %>% 
  filter(year == 2007) %>% 
  ggplot(aes(x = lifeExp, y = continent)) +
  geom_density_ridges(alpha = .5)
```


## Is "year" discrete?

Try plotting how the *distribution* of one of the continuous variables changes by year.
What problem do you encounter?

Now, try replacing `year` by `factor(year)` in your aesthetic mapping. Try making two different distribution plots.
At least one of them should be a ridge plot.
What do you notice about what has happened to the *shape* of the different variables over the years?

```{r include=show_examples}
gapminder %>% 
  ggplot(aes(x = year, y = lifeExp)) + geom_boxplot()
```


```{r include=FALSE}
gapminder %>% 
  ggplot(aes(x = factor(year), y = lifeExp)) + geom_boxplot()
```

```{r include=show_examples}
gapminder %>% 
  ggplot(aes(y = factor(year), x = log(gdpPercap))) + geom_density_ridges()
```


```{r include=show_examples}
gapminder %>% 
  ggplot(aes(y = factor(year), x = lifeExp)) + geom_violin()
```
