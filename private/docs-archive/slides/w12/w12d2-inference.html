<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Making Inferences about Features</title>
    <meta charset="utf-8" />
    <meta name="author" content="DATA 202 21FA" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Making Inferences about Features
### DATA 202 21FA

---






## Logistics

- Final projects
- Midterm 2??
- Discussions
- Quizzes and Homework

---

## What's your goal?

* **Predict** unseen labels
  * How much will this house sell for?
  * Does this child have autism?
  * Is this a positive or negative movie review?
* **Infer** relationships between features and labels
  * How much does home size affect price?
  * Is DNA methylation a marker of autism?
  * Does "sick" indicate a positive or negative review?
* Understand the **causal** effect of interventions
  * How much will building an addition increase the price of my home?
  * Will antioxidants prevent autism?
  * Will cutting this scene make my movie get better reviews?

---

## Techniques for Inference

* Classical statistical inference
  * 2-sample t tests, chi squared tests, ANOVA, ...
  * inference about model parameters (coefficient standard errors etc.)
* Variable importance plots
* Benefit of adding each feature

---

## Objectives for Today

* Identify several different approaches for drawing conclusions about features
* Recognize potential challenges in making those inferences

---

## Palmer Penguins

.pull-left[
&lt;img src="https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/logo.png" width="50%" style="display: block; margin: auto;" /&gt;


```r
library(palmerpenguins)
penguins &lt;- palmerpenguins::penguins %&gt;% 
  filter(!is.na(bill_length_mm), !is.na(bill_depth_mm))
```
]

.pull-right[
&lt;img src="https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/culmen_depth.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.floating-source[
[Artwork by @allison_horst](https://allisonhorst.github.io/palmerpenguins/articles/art.html)
]
---

## How does bill length relate to bill depth?

.small-code[
&lt;img src="w12d2-inference_files/figure-html/penguins-simpsons-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---

## How does bill length relate to bill depth?

&lt;img src="w12d2-inference_files/figure-html/penguins-with-species-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

###  One big model

.panelset[
.panel[.panel-name[Fit Model]

```r
overall_model &lt;- linear_reg() %&gt;%
  fit(bill_depth_mm ~ bill_length_mm, data = penguins)
tidy(overall_model, conf.int = TRUE)
```

```
# A tibble: 2 × 7
  term   estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Inte…  20.9       0.844      24.7  4.72e-78   19.2     22.5   
2 bill_…  -0.0850    0.0191     -4.46 1.12e- 5   -0.123   -0.0475
```
]
.panel[.panel-name[Coefficients]

```r
GGally::ggcoef_model(overall_model$fit) + labs(x = "Coefficient")
```

&lt;img src="w12d2-inference_files/figure-html/overall-model-coef-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Predictions]
.small-code[

```r
augment(overall_model, penguins) %&gt;% 
  ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
    geom_point() +
    geom_line(aes(y = .pred), color = "blue", size = 1) +
    labs(title = "Penguin bill dimensions", subtitle = "Palmer Station LTER", x = "Bill length (mm)", y = "Bill depth (mm)")
```

&lt;img src="w12d2-inference_files/figure-html/single-model-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]]
]

---

### Parallel slopes

.panelset[
.panel[.panel-name[Fit Model]

```r
parallel_slopes_model &lt;- linear_reg() %&gt;%
  fit(bill_depth_mm ~ bill_length_mm
*     + species,
      data = penguins)
tidy(parallel_slopes_model, conf.int = TRUE)
```

```
# A tibble: 4 × 7
  term   estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Inte…   10.6      0.683      15.5  2.43e-41    9.25     11.9  
2 bill_…    0.200    0.0175     11.4  8.66e-26    0.165     0.234
3 speci…   -1.93     0.224      -8.62 2.55e-16   -2.37     -1.49 
4 speci…   -5.11     0.191     -26.7  3.65e-85   -5.48     -4.73 
```
]
.panel[.panel-name[Coefficients]

```r
GGally::ggcoef_model(parallel_slopes_model$fit) + labs(x = "Coefficient")
```

&lt;img src="w12d2-inference_files/figure-html/parallel-slopes-coef-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Predictions]
.small-code[

```r
augment(parallel_slopes_model, penguins) %&gt;% 
* ggplot(aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +
    geom_point() +
    geom_line(aes(y = .pred), size = 1) +
    labs(title = "Penguin bill dimensions", subtitle = "Palmer Station LTER", x = "Bill length (mm)", y = "Bill depth (mm)")
```

&lt;img src="w12d2-inference_files/figure-html/parallel-slopes-model-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
]]

---

### Interactions

.panelset[
.panel[.panel-name[Fit Model]

```r
interaction_model &lt;- linear_reg() %&gt;%
  fit(bill_depth_mm ~ bill_length_mm
*     * species,
      data = penguins)
tidy(interaction_model, conf.int = TRUE)
```

```
# A tibble: 6 × 7
  term   estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Inte…  11.4       1.14      10.0   7.28e-21   9.17      13.6  
2 bill_…   0.179     0.0293     6.11  2.76e- 9   0.121      0.236
3 speci…  -3.84      2.05      -1.87  6.24e- 2  -7.88       0.200
4 speci…  -6.16      1.75      -3.51  5.09e- 4  -9.61      -2.71 
5 bill_…   0.0434    0.0456     0.952 3.42e- 1  -0.0463     0.133
6 bill_…   0.0260    0.0405     0.642 5.22e- 1  -0.0537     0.106
```
]
.panel[.panel-name[Coefficients]

```r
GGally::ggcoef_model(interaction_model$fit) + labs(x = "Coefficient")
```

&lt;img src="w12d2-inference_files/figure-html/interaction-coef-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Predictions]
.small-code[

```r
augment(interaction_model, penguins) %&gt;% 
* ggplot(aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +
    geom_point() +
    geom_line(aes(y = .pred), size = 1) +
    labs(title = "Penguin bill dimensions", subtitle = "Palmer Station LTER", x = "Bill length (mm)", y = "Bill depth (mm)")
```

&lt;img src="w12d2-inference_files/figure-html/interaction-model-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
]]

---

## LINE Assumptions for making inference

- **Linearity**: there's actually a linear relationship
- **Independence**: there's no pattern to the errors
- **Normality of residuals**: no major outliers
- **Equal variance of residuals**: variability doesn't change systematically

These are colloquial wordings. See textbook [section E.4](https://mdsr-book.github.io/mdsr2e/ch-regression.html#assumptions-underlying-regression) for technical and how to verify.

---

## Examples of broken assumptions

- **Linearity**: the hotter the temperature, the more each degree of temperature matters
- **Independence**: ridership for adjacent hours is similar
- **Normality of residuals**: spike in demand after championship game
- **Equal variance of residuals**: bigger variability in demand on weekends vs weekdays

---

## Variable Importance Plots





.small-code[

```r
regresion_workflow &lt;- workflow() %&gt;%  add_model(decision_tree(mode = "regression") %&gt;% set_engine('rpart')) 

model &lt;- regresion_workflow %&gt;% 
  add_recipe(recipe(Sale_Price ~ ., data = ames_train)) %&gt;% 
  fit(data = ames_train)

model %&gt;% extract_fit_engine() %&gt;% vip::vip(num_features = 15L)
```

&lt;img src="w12d2-inference_files/figure-html/tree-vip-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

---

## How much does it help to have a feature in?



.small-code[

```r
regresion_workflow %&gt;% 
  add_recipe(recipe(Sale_Price ~ ., data = ames_train)) %&gt;% 
  fit_resamples(resamples = resamples, metrics = metric_set(mae, rmse)) %&gt;% collect_metrics()
```

```
# A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard    25.7    10   0.438 Preprocessor1_Model1
2 rmse    standard    36.1    10   1.16  Preprocessor1_Model1
```




```r
regresion_workflow %&gt;% 
* add_recipe(recipe(Sale_Price ~ ., data = ames_train) %&gt;% step_rm(ends_with("Qual"))) %&gt;%
  fit_resamples(resamples = resamples, metrics = metric_set(mae, rmse)) %&gt;% collect_metrics()
```

```
# A tibble: 2 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 mae     standard    25.6    10   0.627 Preprocessor1_Model1
2 rmse    standard    36.5    10   1.10  Preprocessor1_Model1
```
]

---

## Variable Importance without the Quality Features


```r
regresion_workflow %&gt;% 
* add_recipe(recipe(Sale_Price ~ ., data = ames_train) %&gt;% step_rm(ends_with("Qual"))) %&gt;%
  fit(data = ames_train) %&gt;%
  extract_fit_engine() %&gt;% vip::vip(num_features = 15L)
```

&lt;img src="w12d2-inference_files/figure-html/tree-vip-without-qual-1.png" width="90%" style="display: block; margin: auto;" /&gt;


---

## Appendix: code

.small-code[



```r
include_graphics("https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/logo.png")
include_graphics("https://raw.githubusercontent.com/allisonhorst/palmerpenguins/master/man/figures/culmen_depth.png")
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Penguin bill dimensions", subtitle = "Palmer Station LTER", x = "Bill length (mm)", y = "Bill depth (mm)")
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species, shape = species)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_manual(values = c("darkorange","purple","cyan4")) +
  labs(title = "Penguin bill dimensions",
       subtitle = "Bill length and depth for Adelie, Chinstrap and Gentoo Penguins at Palmer Station LTER",
       x = "Bill length (mm)",
       y = "Bill depth (mm)",
       color = "Penguin species",
       shape = "Penguin species") +
  theme(legend.position = c(0.85, 0.15),
        legend.background = element_rect(fill = "white", color = NA))
#data(ames, package = "modeldata")
ames &lt;- AmesHousing::make_ames()
ames_all &lt;- ames %&gt;%
  filter(Gr_Liv_Area &lt; 4000, Sale_Condition == "Normal") %&gt;%
  mutate(across(where(is.integer), as.double)) %&gt;%
  mutate(Sale_Price = Sale_Price / 1000)
rm(ames)
set.seed(10) # Seed the random number generator
ames_split &lt;- initial_split(ames_all, prop = 2 / 3)
ames_train &lt;- training(ames_split)
ames_test &lt;- testing(ames_split)
set.seed(0)
resamples &lt;- vfold_cv(ames_train, v = 10)
```
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "4:3",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
